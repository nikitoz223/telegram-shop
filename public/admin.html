<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Админка магазина</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      background: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .header {
      background: #111;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 18px;
      position: relative;
      z-index: 1;
    }

    .panel {
      padding: 20px;
      max-width: 480px;
      margin: auto;
      position: relative;
      z-index: 1;
    }

    h3 {
      margin-top: 25px;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
      box-sizing: border-box;
    }

    button {
      background: #111;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:active {
      transform: scale(0.98);
    }

    hr {
      margin: 25px 0;
      border: none;
      border-top: 1px solid #ddd;
    }
  </style>
</head>
<body>

<div class="header">Админка магазина</div>

<div class="panel">
  <h3>Добавить категорию</h3>
  <input id="catName" placeholder="Название категории">
  <input id="catImage" type="file">
  <button onclick="addCategory()">Добавить категорию</button>

  <hr>

  <h3>Добавить товар</h3>
  <input id="prodName" placeholder="Название товара">
  <input id="prodPrice" placeholder="Цена">
  <input id="prodColor" placeholder="Цвет">

  <select id="prodCategory"></select>

  <input id="prodImage" type="file">
  <button onclick="addProduct()">Добавить товар</button>

  <hr>

  <h3>Добавить админа</h3>
  <input id="adminId" placeholder="Telegram ID нового админа">
  <button onclick="addAdmin()">Добавить админа</button>
</div>

<script>
let tg = null
if (window.Telegram && window.Telegram.WebApp) {
  tg = window.Telegram.WebApp
  tg.expand()
}

const headers = {
  'x-telegram-id': tg?.initDataUnsafe?.user?.id || ''
}

function loadCategories() {
  fetch('/api/categories')
    .then(r => r.json())
    .then(cats => {
      const select = document.getElementById('prodCategory')
      select.innerHTML = ''
      cats.forEach(c => {
        const opt = document.createElement('option')
        opt.value = c.id
        opt.innerText = c.name
        select.appendChild(opt)
      })
    })
}

function addCategory() {
  const name = document.getElementById('catName').value
  const image = document.getElementById('catImage').files[0]

  if (!name || !image) {
    alert('Заполни название и выбери картинку')
    return
  }

  const data = new FormData()
  data.append('name', name)
  data.append('image', image)

  fetch('/api/category', {
    method: 'POST',
    headers,
    body: data
  })
  .then(r => r.text())
  .then(() => {
    alert('Категория добавлена')
    document.getElementById('catName').value = ''
    document.getElementById('catImage').value = ''
    loadCategories()
  })
}

function addProduct() {
  const data = new FormData()
  data.append('name', document.getElementById('prodName').value)
  data.append('price', document.getElementById('prodPrice').value)
  data.append('color', document.getElementById('prodColor').value)
  data.append('category_id', document.getElementById('prodCategory').value)
  data.append('image', document.getElementById('prodImage').files[0])

  fetch('/api/product', {
    method: 'POST',
    headers,
    body: data
  })
  .then(() => {
    alert('Товар добавлен')
  })
}

function addAdmin() {
  fetch('/api/admin', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      ...headers
    },
    body: JSON.stringify({
      id: document.getElementById('adminId').value
    })
  })
  .then(() => alert('Админ добавлен'))
}

loadCategories()
</script>

</body>
</html>
